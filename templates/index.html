<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>知网文章智能采集系统</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .nav-tabs .nav-link {
            color: #495057;
            border: none;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            background-color: #e9ecef;
        }
        
        .nav-tabs .nav-link.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .tab-content {
            background-color: white;
            border-radius: 0 8px 8px 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .article-card {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            background-color: white;
            transition: all 0.3s ease;
        }
        
        .article-card:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .article-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .article-meta {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .article-meta span {
            margin-right: 15px;
        }
        
        .article-abstract {
            color: #495057;
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 10px;
            max-height: 60px;
            overflow: hidden;
        }
        
        .article-tags .badge {
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .btn-success-custom {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            font-weight: 500;
        }
        
        .search-bar {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .selection-toolbar {
            background-color: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            justify-content: space-between;
        }
        
        .pagination {
            margin-top: 20px;
        }
        
        .search-history-item {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            background-color: white;
        }
        
        .status-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
        }
        
        .stat-label {
            color: #6c757d;
            margin-top: 5px;
        }
        
        .progress-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }
        
        .log-container {
            background-color: #1e1e1e;
            color: #ffffff;
            border-radius: 8px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- 页面标题 -->
        <div class="text-center mb-4">
            <h1 class="display-5 fw-bold text-primary">
                <i class="bi bi-search"></i> 知网文章智能采集系统
            </h1>
            <p class="lead text-muted">智能搜索、预览筛选、批量下载</p>
        </div>
        
        <!-- 导航标签 -->
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="search-tab" data-bs-toggle="tab" data-bs-target="#search-panel" type="button" role="tab">
                    <i class="bi bi-search"></i> 智能搜索
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="articles-tab" data-bs-toggle="tab" data-bs-target="#articles-panel" type="button" role="tab">
                    <i class="bi bi-file-text"></i> 文章预览
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="download-tab" data-bs-toggle="tab" data-bs-target="#download-panel" type="button" role="tab">
                    <i class="bi bi-download"></i> 下载管理
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tasks-tab" data-bs-toggle="tab" data-bs-target="#tasks-panel" type="button" role="tab">
                    <i class="bi bi-list-task"></i> 任务管理
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history-panel" type="button" role="tab">
                    <i class="bi bi-clock-history"></i> 搜索历史
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="resources-tab" data-bs-toggle="tab" data-bs-target="#resources-panel" type="button" role="tab">
                    <i class="bi bi-folder2-open"></i> 资源中心
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="status-tab" data-bs-toggle="tab" data-bs-target="#status-panel" type="button" role="tab">
                    <i class="bi bi-gear"></i> 系统状态
                </button>
            </li>
        </ul>
        
        <!-- 标签页内容 -->
        <div class="tab-content" id="mainTabContent">
            <!-- 智能搜索面板 -->
            <div class="tab-pane fade show active" id="search-panel" role="tabpanel">
                <h4><i class="bi bi-search"></i> 智能搜索</h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="keywords" class="form-label">搜索关键词（每行一个）</label>
                            <textarea class="form-control" id="keywords" rows="5" placeholder="请输入搜索关键词，每行一个"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="literatureType" class="form-label">文献类型</label>
                            <select class="form-select" id="literatureType">
                                <option value="">加载中...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="resultCount" class="form-label">每个关键词结果数量</label>
                            <input type="number" class="form-control" id="resultCount" value="50" min="1" max="200">
                        </div>
                        <button class="btn btn-primary btn-lg" onclick="searchManager.startKeywordSearch()">
                            <i class="bi bi-search"></i> 开始搜索
                        </button>
                    </div>
                    <div class="col-md-6">
                        <h5>期刊检索</h5>
                        <div class="mb-3">
                            <label for="journalFile" class="form-label">期刊文件路径</label>
                            <input type="text" class="form-control" id="journalFile" placeholder="期刊Excel文件路径">
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="startYear" class="form-label">开始年份</label>
                                    <input type="number" class="form-control" id="startYear" value="2020">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="endYear" class="form-label">结束年份</label>
                                    <input type="number" class="form-control" id="endYear" value="2024">
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="searchManager.startJournalScrape()">
                            <i class="bi bi-journal"></i> 开始
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 文章预览面板 -->
            <div class="tab-pane fade" id="articles-panel" role="tabpanel">
                <h4><i class="bi bi-file-text"></i> 文章预览与选择</h4>
                
                <!-- 搜索栏 -->
                <div class="search-bar">
                    <div class="row">
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="articleSearch" placeholder="搜索文章标题、作者、摘要...">
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="keywordFilter">
                                <option value="">所有关键词</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="literatureTypeFilter">
                                <option value="">所有文献类型</option>
                                <option value="journal">期刊论文</option>
                                <option value="thesis">学位论文</option>
                                <option value="conference">会议论文</option>
                                <option value="newspaper">报纸文章</option>
                                <option value="book">图书</option>
                                <option value="standard">标准</option>
                                <option value="patent">专利</option>
                                <option value="yearbook">年鉴</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-primary" onclick="articleManager.searchArticles()">
                                <i class="bi bi-search"></i> 搜索
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 文献类型统计 -->
                <div class="literature-stats mb-3" id="literatureStats" style="display: none;">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i class="bi bi-bar-chart"></i> 文献类型统计
                                <button class="btn btn-sm btn-outline-secondary float-end" onclick="articleManager.toggleStats()">
                                    <i class="bi bi-eye-slash" id="statsToggleIcon"></i>
                                </button>
                            </h6>
                            <div class="row" id="statsContent">
                                <!-- 统计内容将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 选择工具栏 -->
                <div class="selection-toolbar" id="selectionToolbar">
                    <div>
                        <span class="selection-count">已选择 0 篇文章</span>
                    </div>
                    <div>
                        <button class="btn btn-outline-primary btn-sm me-2" onclick="articleManager.selectAll()">全选</button>
                        <button class="btn btn-outline-secondary btn-sm me-2" onclick="articleManager.clearSelection()">清空</button>
                        <button class="btn btn-success btn-sm" onclick="articleManager.downloadSelected()">
                            <i class="bi bi-download"></i> 下载选中
                        </button>
                    </div>
                </div>
                
                <!-- 文章列表 -->
                <div id="articlesList">
                    <div class="text-center text-muted py-5">
                        <i class="bi bi-file-text" style="font-size: 3rem;"></i>
                        <p class="mt-3">暂无文章数据</p>
                        <p>请先进行关键词搜索</p>
                    </div>
                </div>
                
                <!-- 分页 -->
                <div id="pagination"></div>
            </div>
            
            <!-- 下载管理面板 -->
            <div class="tab-pane fade" id="download-panel" role="tabpanel">
                <h4><i class="bi bi-download"></i> 下载管理</h4>
                
                <!-- 下载设置 -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="maxWorkers" class="form-label">并发下载数</label>
                            <input type="number" class="form-control" id="maxWorkers" value="3" min="1" max="10">
                        </div>
                        <button class="btn btn-success me-2" onclick="downloadManager.startDownload()">
                            <i class="bi bi-play-fill"></i> 开始下载
                        </button>
                        <button class="btn btn-danger" onclick="downloadManager.stopDownload()">
                            <i class="bi bi-stop-fill"></i> 停止下载
                        </button>
                    </div>
                </div>
                
                <!-- 下载任务列表 -->
                <div id="downloadTasksList">
                    <div class="text-center text-muted py-5">
                        <i class="bi bi-download" style="font-size: 3rem;"></i>
                        <p class="mt-3">暂无下载任务</p>
                    </div>
                </div>
            </div>
            
            <!-- 任务管理面板 -->
            <div class="tab-pane fade" id="tasks-panel" role="tabpanel">
                <h4><i class="bi bi-list-task"></i> 任务管理</h4>
                
                <!-- 任务控制按钮 -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <button class="btn btn-primary me-2" onclick="taskManager.loadTasks()">
                            <i class="bi bi-arrow-clockwise"></i> 刷新任务
                        </button>
                        <button class="btn btn-warning me-2" onclick="taskManager.pauseAllTasks()">
                            <i class="bi bi-pause-fill"></i> 暂停所有任务
                        </button>
                        <button class="btn btn-success me-2" onclick="taskManager.resumeAllTasks()">
                            <i class="bi bi-play-fill"></i> 恢复所有任务
                        </button>
                        <button class="btn btn-danger" onclick="taskManager.stopAllTasks()">
                            <i class="bi bi-stop-fill"></i> 停止所有任务
                        </button>
                    </div>
                </div>
                
                <!-- 任务统计 -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title text-primary" id="runningTasksCount">0</h5>
                                <p class="card-text">运行中</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title text-warning" id="pausedTasksCount">0</h5>
                                <p class="card-text">已暂停</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title text-success" id="completedTasksCount">0</h5>
                                <p class="card-text">已完成</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title text-danger" id="failedTasksCount">0</h5>
                                <p class="card-text">已失败</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 任务列表 -->
                <div id="tasksList">
                    <div class="text-center text-muted py-5">
                        <i class="bi bi-list-task" style="font-size: 3rem;"></i>
                        <p class="mt-3">暂无任务</p>
                    </div>
                </div>
            </div>
            
            <!-- 搜索历史面板 -->
            <div class="tab-pane fade" id="history-panel" role="tabpanel">
                <h4><i class="bi bi-clock-history"></i> 搜索历史</h4>
                <div id="searchHistoryList">
                    <div class="text-center text-muted py-5">
                        <i class="bi bi-clock-history" style="font-size: 3rem;"></i>
                        <p class="mt-3">暂无搜索历史</p>
                    </div>
                </div>
            </div>
            
            <!-- 资源中心面板 -->
            <div class="tab-pane fade" id="resources-panel" role="tabpanel">
                <h4><i class="bi bi-folder2-open"></i> 资源中心</h4>
                <div class="d-flex justify-content-end mb-3">
                    <button class="btn btn-outline-primary btn-sm" id="refreshResourcesBtn">
                        <i class="bi bi-arrow-clockwise"></i> 刷新
                    </button>
                </div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="bi bi-link-45deg"></i> 链接文件</h5>
                                <div id="linkFilesList">
                                    <div class="text-center text-muted py-4">
                                        <i class="bi bi-link-45deg" style="font-size: 2rem;"></i>
                                        <p class="mt-2">暂无链接文件</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="bi bi-download"></i> 下载文件</h5>
                                <div id="downloadFilesList">
                                    <div class="text-center text-muted py-4">
                                        <i class="bi bi-download" style="font-size: 2rem;"></i>
                                        <p class="mt-2">暂无下载文件</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="bi bi-filetype-csv"></i> 导出文件</h5>
                                <div id="exportFilesList">
                                    <div class="text-center text-muted py-4">
                                        <i class="bi bi-filetype-csv" style="font-size: 2rem;"></i>
                                        <p class="mt-2">暂无导出文件</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="bi bi-journal-text"></i> 日志文件</h5>
                                <div id="logFilesList">
                                    <div class="text-center text-muted py-4">
                                        <i class="bi bi-journal-text" style="font-size: 2rem;"></i>
                                        <p class="mt-2">暂无日志文件</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 系统状态面板 -->
            <div class="tab-pane fade" id="status-panel" role="tabpanel">
                <h4><i class="bi bi-info-circle"></i> 系统状态</h4>
                <div id="systemStatus">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">加载中...</span>
                        </div>
                        <p class="mt-2">正在检查系统状态...</p>
                    </div>
                </div>
                
                <!-- 统计信息 -->
                <div class="stats-grid" id="statsGrid" style="display: none;">
                    <div class="stat-item">
                        <div class="stat-number" id="linkCount">0</div>
                        <div class="stat-label">链接文件</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="downloadCount">0</div>
                        <div class="stat-label">已下载文件</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="keywordCount">0</div>
                        <div class="stat-label">配置关键词</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="yearRange">-</div>
                        <div class="stat-label">年份范围</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 任务控制 -->
        <div class="progress-container" id="progressContainer">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 id="taskTitle">任务进行中...</h5>
                <button class="btn btn-danger" onclick="app.stopTask()">
                    <i class="bi bi-stop-fill"></i> 停止任务
                </button>
            </div>
            
            <div class="progress mb-3" style="height: 20px;">
                <div class="progress-bar progress-bar-striped progress-bar-animated" 
                     id="progressBar" role="progressbar" style="width: 0%"></div>
            </div>
            
            <div id="taskMessage" class="text-muted">准备中...</div>
        </div>
        
        <!-- 实时日志 -->
        <div class="status-card">
            <h5><i class="bi bi-terminal"></i> 实时日志</h5>
            <div class="log-container" id="logContainer">
                <div class="text-success">系统已就绪，等待任务...</div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- 模块化JavaScript文件 -->
    <script src="/static/js/app.js"></script>
    <script src="/static/js/articles.js"></script>
    <script src="/static/js/search.js"></script>
    <script src="/static/js/download.js"></script>
    <script src="/static/js/tasks.js"></script>
    <script src="/static/js/resources.js"></script>
    
    <script>
        // 全局变量
        let app, articleManager, searchManager, downloadManager, taskManager, resourceManager;
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化主应用
            app = new CNKIApp();
            
            // 初始化各个管理器
            articleManager = new ArticleManager(app);
            searchManager = new SearchManager(app);
            downloadManager = new DownloadManager(app);
            taskManager = new TaskManager(app);
            resourceManager = new ResourceManager(app);
            
            // 初始化任务管理器
            taskManager.init();
            
            // 加载初始数据
            searchManager.loadSearchHistory();
            downloadManager.loadTasks();
        });
    </script>
</body>
</html>